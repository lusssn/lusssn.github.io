---
title: ç†è§£Manacherç®—æ³•
date: 2020-05-12 14:58:43
tags: 
 - JavaScript
 - ç®—æ³•
---
ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² *S*ï¼Œæ‰¾åˆ° *S* ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚
<!-- more --><style>.post-container p img {width: 393px;}</style>
é’ˆå¯¹è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆå¾ˆå¤šã€‚

åœ¨1975å¹´çš„æ—¶å€™ï¼Œä¸€ä½å«åšManacherçš„äººè§‚å¯Ÿåˆ°æŸ¥æ‰¾å›æ–‡å­ä¸²çš„è§„å¾‹ï¼Œåˆ›é€ å‡ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•ï¼Œå¤§å¹…ä¼˜åŒ–å›æ–‡å­ä¸²æŸ¥æ‰¾æ•ˆç‡ã€‚

è¿™åˆ°åº•æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

é¦–å…ˆï¼Œç¡®å®šç†è§£äº†åœ¨ç¨‹åºè®¾è®¡ä¸­ **å›æ–‡** å’Œ **å­ä¸²** çš„å«ä¹‰ã€‚
> **å›æ–‡ palindromic**
> æ­£è¯»åè¯»éƒ½æ˜¯ä¸€æ ·çš„å­—ç¬¦åºåˆ—ï¼Œä¾‹å¦‚ï¼šnoonã€levelã€‚
> A word, line, verse, number, sentence, etc., reading the same backward as forward.

> **å­ä¸² substring**
> ä¸€ä¸ªå­—ç¬¦ä¸² *s* è¢«ç§°ä½œå¦ä¸€ä¸ªå­—ç¬¦ä¸² *S* çš„å­ä¸²ï¼Œè¡¨ç¤º *s* åœ¨ *S* ä¸­å‡ºç°äº†ã€‚
> A substring is a contiguous sequence of characters within a string.

---

**æœ€ç›´æ¥çš„è§£é¢˜æ€è·¯**æˆ‘è®¤ä¸ºæ˜¯ï¼š
1. éå†å­—ç¬¦ä¸² *S* ä¸­æ¯ä¸ªå­—ç¬¦ï¼›
2. ä»¥æ¯ä¸ªå­—ç¬¦ S[ i ] ä¸ºä¸­å¿ƒï¼Œå‘ä¸¤ä¾§æ‰©å±•ï¼Œæ‰¾åˆ° *S* æ‰€æœ‰å›æ–‡å­ä¸²ï¼›
3. é€‰å‡ºæœ€é•¿çš„å­ä¸²å³ä¸ºç»“æœã€‚

è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä»¥æ¯ä¸ªå­—ç¬¦ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²æŸ¥æ‰¾ï¼Œéƒ½èŠ±è´¹äº†æ—¶é—´ã€‚

å‡è®¾ *S* ä¸º *xabcocbabc*ï¼Œå®ƒçš„æœ€é•¿å›æ–‡å­ä¸²åº”è¯¥æ˜¯å­ä¸² *abcocba*ã€‚

åœ¨ä»å·¦åˆ°å³çš„éå†è¿‡ç¨‹ä¸­ï¼Œéå†åˆ° xabco **c** babc ä¸­ç¬¬2ä¸ª **c** æ—¶ï¼Œ**xabco**cbabc å‰åŠæ®µ **xabco** æ¯ä¸ªå­—ç¬¦çš„åŒ¹é…ç»“æœéƒ½æ˜¯å·²çŸ¥çŠ¶æ€ã€‚ä»¥å­—ç¬¦ *o* ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡å­ä¸²ä¸º abcocbaï¼Œå®ƒæ˜¯å›æ–‡ä¸²ï¼Œé‚£ä¹ˆå®ƒæ­£åè¯»å°±éƒ½ä¸€æ ·ï¼Œä»¥ *o* ä¸ºä¸­å¿ƒå·¦å³å¯¹ç§°ï¼Œå½¢è±¡ç‚¹è¯´ *o* å°±æ˜¯é¢é•œå­ï¼Œ*cba* æ˜¯é•œå­é‡Œé¢çš„*abc*ã€‚ 

![](mirror-image.jpeg)

*cba* å°±æ˜¯ *abc*ï¼Œ*cba* åˆä¸å®Œå…¨æ˜¯ *abc*ï¼ä½ å“ï¼Œä»”ç»†å“ï¼æœ‰å†…å‘³æ²¡æœ‰ï¼Ÿ

å›åˆ°éå†ä¸­æ¥ï¼Œæˆ‘ä»¬ç°åœ¨æ­£éå†åˆ° xabco **c** babc ä¸­ç¬¬2ä¸ª **c**ï¼Œæ­¤æ—¶ x**abc**ocbabc ä¸­ **abc** åŒ¹é…ç»“æœå·²çŸ¥ï¼Œ*cba* ä½œä¸ºâ€œå¦ä¸€ä¸ªâ€ *abc*ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥æŠ„ä¸€æŠ„ *abc* çš„ä½œä¸šï¼Ÿ

---

æˆ‘ä»¬æŠŠè¿™ç§æƒ…å†µè¿›è¡ŒæŠ½è±¡ï¼Œå¹¶è¯¦ç»†åˆ†æä¸€æ³¢ã€‚å¦‚ä¸‹å›¾ï¼š

![](manacher-1.png)

*rightIndex* æ˜¯å½“å‰è®¿é—®åˆ°çš„å­—ç¬¦ä¸­ï¼Œä½ç½®æœ€å³çš„å­—ç¬¦ä¸‹æ ‡ã€‚**ç‰¹åˆ«æ³¨æ„ï¼Œ*rightIndex* ä¸æ˜¯å½“å‰æœ€é•¿å›æ–‡å­ä¸²çš„æœ€å³å­—ç¬¦ä¸‹æ ‡ï¼** *centerIndex* æ˜¯ä¸€ä¸ªå›æ–‡å­ä¸²çš„ä¸­å¿ƒä¸‹æ ‡ï¼Œè¿™ä¸ªå­ä¸²æœ€å³å­—ç¬¦ä¸‹æ ‡å¿…é¡»æ˜¯ *rightIndex - 1* æˆ– *rightIndex*ã€‚ç†è§£è¿™ä¸¤ä¸ªå˜é‡è‡³å…³é‡è¦ï¼
*i* æ˜¯å½“å‰éå†åˆ°çš„å­—ç¬¦ä¸‹æ ‡ï¼Œä»¥ S[ i ] ä¸ºä¸­å¿ƒçš„åŒ¹é…ç»“æŸæ—¶ï¼Œéœ€è¦æ£€æŸ¥ *rightIndex* å’Œ *centerIndex* æ˜¯å¦éœ€è¦æ›´æ–°ã€‚

éå†ç»§ç»­è¿›è¡Œï¼Œ*i* æ¥åˆ°äº† centerIndex çš„å³ä¾§ã€‚

![](manacher-2.png)

ä»¥ *S[centerIndex]* ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²æ˜¯å·¦å³å¯¹ç§°çš„ï¼Œå¦‚æœ *i* ç›¸å¯¹äº centerIndex çš„å¯¹ç§°ç‚¹ä¸º *j* ï¼š

![](manacher-3.png)

é‚£ä¹ˆä»¥ *S[ j ]* ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²å¿…ç„¶ä¸ä»¥ S[ i ] ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²å¯¹ç§°ç›¸ç­‰ã€‚

![](manacher-4.png)

æˆ‘ä»¬çš„éå†æ˜¯ä»å·¦å¾€å³çš„é¡ºåºï¼Œåˆ° *i* ä½ç½®çš„æ—¶å€™ï¼Œ*j* ä½ç½®çš„åŒ¹é…ç»“æœæ˜¯å·²çŸ¥çš„ï¼Œæ‰€ä»¥è¿›è¡Œ *i* ä½ç½®çš„åŒ¹é…æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥å¤ç”¨å‰é¢çš„åŒ¹é…ç»“æœï¼š

![](manacher-5.png)

å¦™å•Šï½ï½ï½

---

ä¸Šé¢è¿™ä¸ªä¼˜åŒ–æ€è·¯å°±æ˜¯Manacherç®—æ³•çš„æ ¸å¿ƒæ€æƒ³ï¼Œä¸€å¥è¯æ€»ç»“ï¼š**å°½å¯èƒ½å¤šå¤ç”¨å·²çŸ¥çš„æŸ¥æ‰¾ç»“æœ**ã€‚
åœ¨Manacherç®—æ³•ä¸­ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ•°ç»„ç±»å‹çš„è¾…åŠ©é‡ *r*ï¼Œr[ i ] è¡¨ç¤ºä»¥å­—ç¬¦ S[ i ] ä¸ºä¸­å¿ƒçš„æœ€é•¿å›æ–‡å­ä¸²çš„åŠå¾„ã€‚

```
S:  x a b c o c b a b c
r:  1 1 1 1 4 1 1 3 1 1
```

åªè¦æ±‚å¾— *S* å¯¹åº”çš„ *r* æ•°ç»„ï¼Œä¸å°±èƒ½çŸ¥é“æœ€é•¿å›æ–‡å­ä¸²äº†ä¹ˆï¼

*PSï¼šä¸ºä»€ä¹ˆè¾…åŠ©é‡æ˜¯åŠå¾„ï¼Ÿ*
å¹¶ä¸éå¾—æ˜¯åŠå¾„ï¼Œå­˜ç›´å¾„ä¹Ÿå¯ï¼Œç”šè‡³å­˜å­ä¸²ä¹Ÿå¯ã€‚ä½†äº‹æƒ…è¿˜æ˜¯èƒ½ç®€å•å°±ç®€å•ä¸€ç‚¹ï¼Œé€šè¿‡åŠå¾„ r å¯ä»¥ç®—å¾—ç›´å¾„ dï¼ˆd = 2 * r - 1ï¼‰ï¼›ç”¨ä¸­å¿ƒå­—ç¬¦ä¸‹æ ‡å’Œå­ä¸²åŠå¾„æ‰¾åˆ°å­ä¸²ä¹Ÿæ˜¯è½»è½»æ¾æ¾ï¼Œé‡ç‚¹æ˜¯æ•°å­—æ¯”å­—ç¬¦ä¸²èŠ‚çœç©ºé—´å‘€ï¼

Manacheråœ¨ç®—æ³•ä¸­ç»™å‡ºäº† *r* æ•°ç»„çš„æ±‚å–å…¬å¼ï¼š

**r[ i ] = rightIndex > i ? min( r[ j ], rightIndex - i ) : 1**
å…¶ä¸­ *j = centerIndex - ( i - centerIndex ) = 2centerIndex - i*

---

æˆ‘ä»¬æ¥å¥½å¥½ç¢ç£¨ç¢ç£¨è¿™ä¸ªå…¬å¼ã€‚

`rightIndex <= i` æ—¶ï¼Œåœ¨å·²çŸ¥ç»“æœä¸­ï¼Œå¹¶æ²¡æœ‰ *i* ä½ç½®çš„å¯¹ç§°ç‚¹ï¼Œæ‰€ä»¥åªèƒ½é‡ç½® r[ i ] åˆå§‹å€¼ä¸º 1ï¼Œå†ä»¥ S[ i ] ä¸ºä¸­å¿ƒåŒ¹é…å­ä¸²ï¼Œæœ€åç®—å¾— r[ i ] ç»“æœï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚
`rightIndex > i` æ—¶ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥å– r[ j ] çš„å€¼ä½œä¸º r[ i ] çš„åˆå§‹å€¼å‘¢ï¼Ÿä¹‹å‰ä¸æ˜¯è¯´ r[ i ] å¯ä»¥å¤ç”¨ r[ j ] çš„å—ï¼Ÿ

![](manacher-5.png)

è¿™æ˜¯å› ä¸ºè¿˜ä¼šé‡åˆ°ä¸€ç§æƒ…å†µï¼š

![](manacher-6.png)

æ­¤æ—¶ï¼Œä»¥ *j* ä½ç½®ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²æ¯”è¾ƒé•¿ï¼Œå­ä¸²æœ€å·¦ä¾§è¶…å‡ºäº†ä»¥ *centerIndex* ä½ç½®ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²çš„èŒƒå›´ï¼Œè¶…å‡ºçš„éƒ¨åˆ†æ˜ å°„åˆ° *centerIndex* å³ä¾§å°±è·‘åˆ°äº† *rightIndex* çš„å³ä¾§æœªåŒ¹é…åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ç°è‰²éƒ¨åˆ†ã€‚æ‰€ä»¥ä¸å¯ä»¥ç›´æ¥å– r[ j ] çš„å€¼ä½œä¸º r[ i ] çš„ç»“æœï¼

ä½†ä¹Ÿä¸æ˜¯ r[ j ] çš„å…¨éƒ¨ä¸å¯å¤ç”¨ï¼Œåªè¦åšä¸€ä¸‹é€‚å½“è£å‰ªå°±å¥½å•¦ï¼
çœ‹å›¾å¯çŸ¥ï¼Œå¯å¤ç”¨èŒƒå›´æœ€å¤šåˆ° *rightIndex* ä½ç½®ï¼ŒèŒƒå›´åŠå¾„ä¸º **rightIndex - i**ã€‚

å–å¾—å¯å¤ç”¨ç»“æœåï¼Œå¯¹æœªåŒ¹é…åŒºåŸŸå°±è€è€å®å®åˆ¤æ–­è®¡ç®— r[ i ] æœ€ç»ˆç»“æœã€‚

---

å¦‚æœåˆ°è¿™é‡Œï¼Œä½ éƒ½çœ‹å¾—å¾ˆæ˜ç™½ï¼Œæ­å–œä½ ï¼Œä½ å·²ç»ç†è§£äº†Manacherç®—æ³•ï¼ğŸ‰ğŸ‰ğŸ‰

ä¸‹é¢æˆ‘ä»¬å°±æŒ½èµ·è¢–å­å¼€å§‹æ’¸ä»£ç å§ï½

ç­‰ç­‰ç­‰ã€‚ã€‚ã€‚ç­‰ä¸€ä¸‹ï¼è¿˜æœ‰2ä¸ªç®—æ³•ä¹‹å¤–çš„ç‚¹è¦ç¨å¾®æä¸€æã€‚

1. ***S* çš„é•¿åº¦æ˜¯æœªçŸ¥çš„ï¼Œå¯èƒ½æ˜¯å¥‡æ•°ï¼Œå¯èƒ½æ˜¯å¶æ•°ã€‚**
  ä¸¤ç§æƒ…å†µåœ¨åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºå›æ–‡æ—¶ï¼Œå–å¯¹ç§°ä¸­å¿ƒçš„æ–¹å¼ä¸å¤ªä¸€æ ·ã€‚
  ä¸ºäº†æ¶ˆé™¤å·®å¼‚ï¼Œä¸€ä¸ªåšæ³•æ˜¯æ·»åŠ è¾…åŠ©å­—ç¬¦ï¼Œå°†å­—ç¬¦ä¸²çš„é•¿åº¦ç»Ÿä¸€æˆå¥‡æ•°ï¼Œæ¯”å¦‚ï¼šabc --> #a#b#c#ï¼Œnoon --> #n#o#o#n#
  å¦‚æœä¸å«Œéº»çƒ¦ï¼Œä¹Ÿå¯ä»¥ä¸åŠ è¾…åŠ©å­—ç¬¦ã€‚
2. **ä»¥ *S[ i ]* ä¸ºä¸­è½´åˆ¤æ–­è½´å·¦å³ä¸¤è¾¹å­—ç¬¦æ˜¯å¦ç›¸ç­‰çš„åšæ³•ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»å¾ªç¯ã€‚**
  æ¯”å¦‚ï¼š#n#o#o#n#ï¼Œæ•´ä¸ªå­—ç¬¦ä¸²æ»¡è¶³å›æ–‡ï¼Œä»¥ S[ 4 ] ä¸ºä¸­è½´æ—¶ï¼Œå·¦å³ä¸¤è¾¹è¶…å‡ºè¾¹ç•Œæ—¶ä»ç„¶ç›¸ç­‰ï¼Œç¨‹åºå‡ºç°æ­»å¾ªç¯ã€‚
  ä¸€ä¸ªåšæ³•æ˜¯åœ¨å­—ç¬¦ä¸²é¦–å†æ·»åŠ ä¸€ä¸ªè¾…åŠ©å­—ç¬¦ï¼Œå¦‚ï¼š$#n#o#o#n#ã€‚
  å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨å–ä¸­è½´å·¦å³ä¸¤è¾¹å­—ç¬¦æ—¶åšæœ‰æ•ˆåˆ¤æ–­ã€‚

{% spoiler JavaScript ä»£ç å®ç° %}
```javascript
function longestPalindrome(str) {
  let maxRadius = 0
  let maxCenterIndex = 0
  const s = `$#${str.split('').join('#')}#`
  const sLen = s.length
  // å›æ–‡å­ä¸²çš„åŠå¾„
  const r = new Array(sLen)

  // å½“å‰å·²åŒ¹é…å­ä¸²çš„ä¸­å¿ƒæ¸¸æ ‡
  let centerIndex = 0
  // å½“å‰å·²åŒ¹é…å­ä¸²çš„æœ€å³ä¾§æ¸¸æ ‡
  let rightIndex = 0

  for (let i = 1; i < sLen; i++) {
      // å½“å‰å·²åŒ¹é…å­ä¸²çš„æœ€å³ä¾§æ¸¸æ ‡åœ¨
      if (rightIndex > i) {
        r[i] = Math.min(r[2 * centerIndex - i], rightIndex - i)
      } else {
        r[i] = 1
      }
      // ä»¥ i ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²å¯èƒ½è¶…è¿‡rightIndexï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å±•å­ä¸²åŠå¾„
      while(s[i-r[i]] === s[i+r[i]]) {
        r[i]++
      }
      // å¦‚æœä»¥ i ä¸ºä¸­å¿ƒçš„å›æ–‡å­ä¸²åŠå¾„è¿›è¡Œäº†æ‰©å±•ï¼Œæ›´æ–°è¾…åŠ©æ ‡è®°
      if (rightIndex < i + r[i]) {
        // æ›´æ–°å½“å‰å·²åŒ¹é…å­ä¸²çš„æœ€å³ä¾§æ¸¸æ ‡
        rightIndex = i + r[i]
        // å½“å‰å·²åŒ¹é…å­ä¸²çš„ä¸­å¿ƒæ¸¸æ ‡
        centerIndex = i
      }
      // æ›´æ–°å›æ–‡å­ä¸²çš„æœ€å¤§åŠå¾„
      if (maxRadius < r[i]) {
        maxRadius = r[i]
        maxCenterIndex = i
      }
  }

  return str.substr((maxCenterIndex - maxRadius) / 2, maxRadius - 1)
}
```
{% endspoiler %}
